# Dockter 部署指南

## 概述

Dockter 是一个强大的 Docker 容器管理平台，支持通过 Docker Compose 方式快速部署。本文档将详细介绍如何使用 Docker Compose 部署 Dockter。

## 部署方式

### 使用 Docker Compose 部署

推荐使用 Docker Compose 方式部署 Dockter，便于管理和维护。

#### 创建 Compose 文件

创建 `docker-compose.yml` 文件，内容如下：

```yaml
services:
  dockter:
    image: shenxianmq/dockter:latest
    container_name: dockter
    restart: always
    # 使用 host 网络模式，默认端口为 9028
    network_mode: host
    privileged: true
    environment:
      # 时区设置
      - TZ=Asia/Shanghai
      
      # 许可证密钥（必填）
      - LICENSE_KEY=******
      
      # HTTP 代理设置（可选，如不需要代理可删除此行）
      - HTTP_PROXY=http://192.168.31.2:7890
      
      # 宿主机 Compose 文件存放目录（必填）
      # 对应 volumes 中 /volume1/docker:/opt/compose 的左侧路径
      - HOST_STACK_DIR=/volume1/docker
      
      # 容器内 Compose 文件目录（固定值，无需修改）
      # 对应 volumes 中 /volume1/docker:/opt/compose 的右侧路径
      - DOCKTER_STACK_DIR=/opt/compose
      
      # Dockter 自身容器名称（必填）
      # 必须与 container_name 的值保持一致
      - DOCKTER_SELF_CONTAINER=dockter
      
    volumes:
      # 系统组件挂载（必需）
      # 注意：群晖、极空间系统请删除 /etc/docker 这一行挂载
      - /etc/docker:/etc/docker:rw
      - /var/run/docker.sock:/var/run/docker.sock:ro

      # 配置文件挂载（必需）
      # 用于持久化 Dockter 的配置和数据
      - /volume1/docker/dockter/config:/app/config
      - /volume1/docker/dockter/static:/app/static
  
      # Compose 文件存放根目录（必需）
      # 左侧为宿主机目录，右侧为容器内目录（固定为 /opt/compose）
      - /volume1/docker:/opt/compose
```

#### 配置说明

**环境变量说明：**

- `TZ`: 设置容器时区，建议使用 `Asia/Shanghai`（中国时区）
- `LICENSE_KEY`: 许可证密钥，必填项，请替换为您的实际密钥
- `HTTP_PROXY`: HTTP 代理地址（可选），如果您的网络环境需要代理才能访问外网，请配置此项
- `HOST_STACK_DIR`: 宿主机上存放 Compose 文件的目录路径
- `DOCKTER_STACK_DIR`: 容器内 Compose 文件目录，固定为 `/opt/compose`，无需修改
- `DOCKTER_SELF_CONTAINER`: Dockter 容器名称，必须与 `container_name` 保持一致

**卷挂载说明：**

- `/etc/docker:/etc/docker:rw`: Docker 配置文件挂载（群晖、极空间系统请删除此行）
- `/var/run/docker.sock:/var/run/docker.sock:ro`: Docker 套接字挂载，用于容器管理
- `/volume1/docker/dockter/config:/app/config`: 配置文件持久化目录
- `/volume1/docker/dockter/static:/app/static`: 静态文件持久化目录
- `/volume1/docker:/opt/compose`: Compose 文件根目录挂载

#### 部署步骤

1. **准备目录结构**

   确保以下目录存在（如果不存在会自动创建）：
   ```
   /volume1/docker/dockter/config
   /volume1/docker/dockter/static
   /volume1/docker  # Compose 文件存放目录
   ```

2. **修改配置**

   根据您的实际环境修改以下内容：
   - 将 `LICENSE_KEY` 替换为您的许可证密钥
   - 修改 `HOST_STACK_DIR` 为您的实际目录路径
   - 修改所有卷挂载路径为您的实际路径
   - 如果是群晖｜极空间系统，删除 `/etc/docker` 挂载行
   - 如不需要代理，删除 `HTTP_PROXY` 环境变量

3. **启动服务**

   在 `docker-compose.yml` 文件所在目录执行：
   ```bash
   docker-compose up -d
   ```

4. **访问服务**

   部署完成后，在浏览器中访问：
   ```
   http://您的服务器IP:9028
   账号：admin
   密码：password
   ```

#### 特殊说明

**群晖|极空间系统部署注意事项：**

- 必须删除 `/etc/docker:/etc/docker:rw` 这一行挂载配置
- 其他配置保持不变

**路径配置说明：**

- `HOST_STACK_DIR` 环境变量必须与 Compose 文件根目录挂载的左侧路径完全一致
- 例如：如果挂载为 `/volume1/docker:/opt/compose`，则 `HOST_STACK_DIR` 应设置为 `/volume1/docker`

## 验证部署

部署完成后，可以通过以下方式验证：

1. 检查容器状态：
   ```bash
   docker ps | grep dockter
   ```

2. 查看容器日志：
   ```bash
   docker logs dockter
   ```

3. 访问 Web 界面，确认可以正常打开登录页面

## 常见问题

### Q: 容器启动失败怎么办？
A: 检查日志 `docker logs dockter`，常见原因包括：
- 许可证密钥未配置或无效
- 目录权限不足
- 端口 9028 被占用

### Q: 如何更新 Dockter？
A: 执行以下命令：
```bash
docker-compose pull
docker-compose up -d
```

### Q: 如何备份配置？
A: 备份 `/volume1/docker/dockter/config` 目录即可

### Q: 群晖系统部署有什么特殊要求？
A: 必须删除 `/etc/docker` 挂载行，其他配置与普通 Linux 系统相同